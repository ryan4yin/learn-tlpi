# 文件 I/O 缓存

出于性能考虑, 系统 I/O 调用与用户空间的库实现都会在进行文件 I/O 时使用缓冲区, 并不会立即读写.

缓冲区分类两层:

- 用户空间的缓冲区
  - 由 C 语言或其他语言的标准库实现, 位于用户空间.
- 内核空间缓冲区
  - 因为有它的存在, 即使用户空间的程序将缓冲区数据全部刷入了内核, 也不代表数据已经落入硬盘.
  - 一个常见的操作是, 在拔出 USB 移动硬盘前, 都建议手动调用一次 `sync` 命令, 确保内核缓冲区的数据都已经写入磁盘.

## stdio 库的缓冲

一个常见的操作是手动调用 `fflush()` 函数强制将 stdio 输出流中的数据刷新到内核缓冲区中.

## 内核缓冲

UNIX 提供了多种缓冲同步模式:

- syncronized I/O data integrity completion
  - 只确保必要的数据已经完成了同步
- syncronized I/O file integrity completion
  - 比 data intergrity 更严格, 它要求所有发生更新的文件元数据都已经同步到了硬盘上. 相对的性能更差.

相关的系统调用如下:

```c


```

